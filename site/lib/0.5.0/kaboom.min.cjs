var Ns=Object.defineProperty;var te=Object.getOwnPropertySymbols;var Ys=Object.prototype.hasOwnProperty,$s=Object.prototype.propertyIsEnumerable;var ee=(y,_,T)=>_ in y?Ns(y,_,{enumerable:!0,configurable:!0,writable:!0,value:T}):y[_]=T,mt=(y,_)=>{for(var T in _||(_={}))Ys.call(_,T)&&ee(y,T,_[T]);if(te)for(var T of te(_))$s.call(_,T)&&ee(y,T,_[T]);return y};var Rt=(y,_)=>()=>(_||y((_={exports:{}}).exports,_),_.exports);var ne=Rt((js,se)=>{se.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvgAAAAICAYAAACML4vTAAAAAXNSR0IArs4c6QAABo1JREFUeJzdW9uO5SgMJKv9/1/OPnQnDabKVQb6zGgtjeYkvmJsYwh9tQLc931//7yu63retdba+/4hTZ6ZDMQ3wHVdPe1kXk/60He2D/J7HLMhGyOwHQKji/o/BYmv40DecRq+cfgr8l8dhBfRLPF3v6F9Cu/ObwFPYxRBFptE7mA/wQ2yWMwI/1r+y3Bq/h4H3TwJ3fl16xcz4UfQPB+oplF9QJ7id+SjMVjz/wf5e5rK+hKfB9+a86PsZTIm+7P6942jufsqSvg7/END5WSg6ojLt7uurcjL6v8pfQ4doinIL9v+f4HTMfQ3gopR5gOQ+6jviPj7EfLvqQGsQFiXb/B7KMBGc/rQ3x1ONuHmBmOQfd93XwDVguPI/3Uw/fc8Dz5s4/xMogU/xScNKILJb4W5Q/YyXtt+IWcyF+GzMajY7ehZbCK5vf2sGczmJ+J6O6J8pT8dB5HPwPU706/knsjfVRlxvhje0Zn5H+F/m/+kf6uA1oxqPVD1Jeqj+kHuRr5x0ZzzU8nJANrCalDS5A54xV9Ynyd+p/6bNXSiBfY5Dk1pkPyObzI0s10ceFr+3+FXsMq/qk+BM97TusU6bIvp+Flf1ufuy/OJBh817s/vlcKOaOHgRBOeyu0nppt4uIEA+gcboLLv96oIu18IFLhfSRooMh19hsvkKyNjkCo6R+fXC3ya/ddAdjrekxH2i8VmiH23oGTNYy+n2iBHyPhYjtWV8IJtyz38BW6a42JMKuJtn30IfgJT+PdkziayaP1W+OpX6J6HyJ+ac8MXaJEvNfnGGheVow34neAn/tag30aByRfI5PDBlZ9tzNghHuJDMnZpGO37rMam/L/Jj2w6wY/8TH1gPCNfQ3zxAJTZ3wPKkS9EIS9bm3OfbDonof9YWgw7gCJ0uqF+390/JIs1QZE+yhjkKOcifMKDdMX3kYbxKB3xn8fsNZEPPm2SBQ7KD/OkkgXZfYV/PV/U/+rok0IswDH+HDyCmAcuXs1LHP8gBzTyd487dIrgAPPfC489wK6K/GwjouYoo6nmZQXUHCtA9RThd+yX87fIn9X3T8Kkl2yC3zlS+NZK9XUClruFjU3093IcBFui8U79Zfg74Flj7dRHJJ/1Hq58xAs3JAdgNb9QDxHB9f8JfgSV+c96QaVnCcRhzx3+r+hXY9qtq1HmKy+up3Ft3T7BN06gWVDGZhI5JL4b6Mh9yolu5T6iukMN7M4KQqWZ/SKYP9+lYJyAOYtPveMy5IPdZja//XPVnkw+tBHdPe35w8kWs3UX+tjNrtggvpWvM3H8Lihi5f/dE1kVD068PL7O+Fc2z65eNseuDEfHKoxFpx4fjm9bS+LjFyEu4F8P4gras1geqq8QzK9wlJ3IWYJk3TtS8zbvV8MN2qGvaxQOXt3YafKe2NjN8U8A2hzGDQpdg37xqzurObB3dOY9uyYG8nG37pXjp9rg7wQm+v0A201GvGqUd4KfFlejgUobxCDjixAXod3NiWVfRaa6YsT0hitIWWAqXyr+JdhYBDJbSg32Y8fOFZvVDdziBq/cABPY8WEKpxf31fgnMM2xq681u9HYagAM/6mxDmM0eXaBNhCELgKt36Z+Vf9GYoDLrsg496TZ8yFg629dEL+D7sDq4FB8bIF7xTaxI2X8Q9dJWf7Y/ks2iPYGf2HsWf5HnOovUH2m4896Q9JDDs+rV7TduKs2+EcLNdnhvM/f+MqCEp8tO437h9C2YEP2nL7/5WR2G79sgYwGqo1ElJHu4F9msAkC84Lscxd4Bg5/ansGhVOAKf7MAuBu4NC8seJ1mQ0lku/okM090M/iS8HuAq/ivxJ/To1RMrDg/G8OTuVHub4e1j/wg9xBuF5fbPJVTlTsdOaPrmdiHVqK3UN/w+Xmz2r+K/mQf6G5RnauwDuHm80oGwCLkZMbHLYB/nkYm9Md/yF6NDa3SR9sNPM/0rD+cpgf8ws+qifOGN35XK2bHznBj3xWEKHTy+QT5HYiGJ83kW3lP5ZI4MTmKU1a9rcFbNyFT76OzVC+olP2tQYLEJNfGmO2iVs4AU/nd/PzejrHiM58z/BWvjnzs+J7QEvxzlcQgFupJxXfVuSjuFP11NFp4bI76IVnpZ/a7cxfRkNiIxtL9n41f1yayhrngmrG5LwYdWkp/x35h9Yg1WC6vlYNuStvKeZW+h9zfR/eIboHxD12Bml87PYgiCZZP5Z81fI5lrm5k0fxfWVj+x9lSgjp7YOOoAAAAABJRU5ErkJggg=="});var re=Rt((Ws,ie)=>{ie.exports=`attribute vec3 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_uv;
varying vec4 v_color;

void main() {
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = vec4(a_pos, 1.0);
}
`});var ae=Rt((Zs,oe)=>{oe.exports=`precision mediump float;

varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

void main() {
	gl_FragColor = v_color * texture2D(u_tex, v_uv);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`});module.exports=(y={})=>{let _=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",T="unscii",ce=ne(),b={lastLoaderID:0,loadRoot:"",loaders:{},sprites:{},sounds:{},fonts:{}};function ue(){St(T,ce,8,8)}function At(e){let t=new Image;return t.crossOrigin="",t.src=e,new Promise((s,n)=>{t.onload=()=>{s(t)},t.onerror=()=>{n()}})}function tt(){let e=b.lastLoaderID;return b.loaders[e]=!1,b.lastLoaderID++,{done(){b.loaders[e]=!0}}}function he(){let e=0,t=0;for(let s in b.loaders)e+=1,b.loaders[s]&&(t+=1);return t/e}function fe(e){return e&&(b.loadRoot=e),b.loadRoot}function Et(e){return e.startsWith("data:")}function St(e,t,s,n,i){return new Promise((u,r)=>{let h=tt(),c=Et(t)?t:b.loadRoot+t;At(c).then(a=>{b.fonts[e]=Ie(gt(a),s,n,i||_),u(b.fonts[e])}).catch(()=>{v(`failed to load font '${e}' from '${t}'`),r()}).finally(()=>{h.done()})})}function de(e,t,s={}){function n(i,u,r={}){let h=[],c=gt(u),a=r.sliceX||1,m=r.sliceY||1,g=1/a,k=1/m;for(let E=0;E<m;E++)for(let S=0;S<a;S++)h.push(Y(S*g,E*k,g,k));let w={tex:c,frames:h,anims:r.anims||{}};return b.sprites[i]=w,w}return new Promise((i,u)=>{if(typeof t=="string"){let r=tt(),h=Et(t)?t:b.loadRoot+t;At(h).then(c=>{i(n(e,c,s))}).catch(()=>{v(`failed to load sprite '${e}' from '${t}'`),u()}).finally(()=>{r.done()});return}else i(n(e,t,s))})}function le(e,t,s={}){return new Promise((n,i)=>{if(typeof t=="string"){let u=tt();fetch(b.loadRoot+t).then(r=>r.arrayBuffer()).then(r=>new Promise((h,c)=>{R.ctx.decodeAudioData(r,a=>{h(a)},a=>{c()})})).then(r=>{R.sounds[e]=r}).catch(()=>{v(`failed to load sound '${e}' from '${t}'`),i()}).finally(()=>{u.done()})}})}let d={keyStates:{},charInputted:[],mouseState:"up",mousePos:f(0,0),time:0,realTime:0,skipTime:!1,dt:0,scale:1,isTouch:!1},kt={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"},me=["space","left","right","up","down","tab","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11"],o;function pe(){d.canvas=y.canvas,d.canvas||(d.canvas=document.createElement("canvas"),(y.root||document.body).appendChild(d.canvas)),d.scale=y.scale||1,y.fullscreen?(d.canvas.width=window.innerWidth,d.canvas.height=window.innerHeight):(d.canvas.width=(y.width||640)*d.scale,d.canvas.height=(y.height||480)*d.scale);let e=["outline: none"];y.crisp&&(e.push("image-rendering: pixelated"),e.push("image-rendering: crisp-edges")),d.canvas.style=e.join(";"),d.canvas.setAttribute("tabindex","0"),o=d.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),ve(),Le(),ue(),d.isTouch="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,d.canvas.addEventListener("contextmenu",t=>{t.preventDefault()}),d.canvas.addEventListener("mousemove",t=>{d.mousePos=f(t.offsetX,t.offsetY).scale(1/d.scale)}),d.canvas.addEventListener("mousedown",t=>{d.mouseState="pressed"}),d.canvas.addEventListener("mouseup",t=>{d.mouseState="released"}),d.canvas.addEventListener("touchstart",t=>{let s=t.touches[0];d.mousePos=f(s.clientX,s.clientY).scale(1/d.scale),d.mouseState="pressed"}),d.canvas.addEventListener("touchmove",t=>{let s=t.touches[0];d.mousePos=f(s.clientX,s.clientY).scale(1/d.scale)}),d.canvas.addEventListener("keydown",t=>{let s=kt[t.key]||t.key.toLowerCase();me.includes(s)&&t.preventDefault(),s.length===1&&d.charInputted.push(s),s==="space"&&d.charInputted.push(" "),t.repeat?d.keyStates[s]="rpressed":d.keyStates[s]="pressed"}),d.canvas.addEventListener("keyup",t=>{let s=kt[t.key]||t.key.toLowerCase();d.keyStates[s]="released"}),d.canvas.focus(),document.addEventListener("visibilitychange",t=>{switch(document.visibilityState){case"visible":d.skipTime=!0,R.ctx.resume();break;case"hidden":R.ctx.suspend();break}}),y.debug&&(D.showLog=!0)}function Tt(e){return e==="pressed"||e==="rpressed"?"down":e==="released"?"up":e}function G(e){let t=p();return e?t.cam.ignore.includes(e)?G():t.camMousePos:d.mousePos.clone()}function pt(){return d.mouseState==="pressed"}function It(){return d.mouseState==="pressed"||d.mouseState==="down"}function Dt(){return d.mouseState==="released"}function Ft(e){return d.keyStates[e]==="pressed"}function Pt(e){return d.keyStates[e]==="pressed"||d.keyStates[e]==="rpressed"}function Mt(e){return d.keyStates[e]==="pressed"||d.keyStates[e]==="rpressed"||d.keyStates[e]==="down"}function Lt(e){return d.keyStates[e]==="released"}function ge(){return d.charInputted}function q(){return d.dt}function qt(){return d.time}function ye(){return d.canvas.toDataURL()}let et=9,xe=re(),we=ae(),l={drawCalls:0,cam:f(0,0),transform:P(),transformStack:[]};function ve(){l.mesh=ke(65536,65536),l.prog=Te(xe,we),l.defTex=gt(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1));let e=y.clearColor||[0,0,0,1];o.clearColor(e[0],e[1],e[2],e[3]),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.enable(o.DEPTH_TEST),o.enable(o.BLEND),o.depthFunc(o.LEQUAL),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA)}function Ct(){l.mesh.flush(),!!l.curTex&&(l.mesh.bind(),l.prog.bind(),l.curTex.bind(),o.vertexAttribPointer(0,3,o.FLOAT,!1,et*4,0),o.enableVertexAttribArray(0),o.vertexAttribPointer(1,2,o.FLOAT,!1,et*4,12),o.enableVertexAttribArray(1),o.vertexAttribPointer(2,4,o.FLOAT,!1,et*4,20),o.enableVertexAttribArray(2),o.drawElements(o.TRIANGLES,l.mesh.count(),o.UNSIGNED_SHORT,0),l.drawCalls++,l.prog.unbind(),l.mesh.unbind(),l.curTex=null)}function _e(){o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),l.drawCalls=0,l.transformStack=[],l.transform=P()}function be(e){return f(e.x/B()*2-1,-e.y/N()*2+1)}function Re(){Ct()}function Ae(e){l.transform=e.clone()}function Ut(e){!e||e.x===0&&e.y===0||(l.transform=l.transform.translate(e))}function Ee(e){!e||e.x===0&&e.y===0||(l.transform=l.transform.scale(e))}function Xs(e){!e||(l.transform=l.transform.rotateX(e))}function Os(e){!e||(l.transform=l.transform.rotateY(e))}function Se(e){!e||(l.transform=l.transform.rotateZ(e))}function zt(){l.transformStack.push(l.transform.clone())}function Bt(){l.transformStack.length>0&&(l.transform=l.transformStack.pop())}function ke(e,t){let s=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,s),o.bufferData(o.ARRAY_BUFFER,e*32,o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,null);let n=o.createBuffer();o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n),o.bufferData(o.ELEMENT_ARRAY_BUFFER,t*2,o.DYNAMIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null);let i=0;return{vbuf:s,ibuf:n,vqueue:[],iqueue:[],push(u,r){r=r.map(h=>h+this.vqueue.length/et),this.vqueue=this.vqueue.concat(u),this.iqueue=this.iqueue.concat(r)},flush(){o.bindBuffer(o.ARRAY_BUFFER,this.vbuf),o.bufferSubData(o.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),o.bindBuffer(o.ARRAY_BUFFER,null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.ibuf),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null),i=this.iqueue.length,this.iqueue=[],this.vqueue=[]},bind(){o.bindBuffer(o.ARRAY_BUFFER,this.vbuf),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.ibuf)},unbind(){o.bindBuffer(o.ARRAY_BUFFER,null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null)},count(){return i}}}function gt(e){let t=o.createTexture();return o.bindTexture(o.TEXTURE_2D,t),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.bindTexture(o.TEXTURE_2D,null),{id:t,width:e.width,height:e.height,bind(){o.bindTexture(o.TEXTURE_2D,this.id)},unbind(){o.bindTexture(o.TEXTURE_2D,null)}}}function Te(e,t){let s=o.createShader(o.VERTEX_SHADER);o.shaderSource(s,e),o.compileShader(s);var n=o.getShaderInfoLog(s);n&&v(n);let i=o.createShader(o.FRAGMENT_SHADER);o.shaderSource(i,t),o.compileShader(i);var n=o.getShaderInfoLog(i);n&&v(n);let u=o.createProgram();o.attachShader(u,s),o.attachShader(u,i),o.bindAttribLocation(u,0,"a_pos"),o.bindAttribLocation(u,1,"a_uv"),o.bindAttribLocation(u,2,"a_color"),o.linkProgram(u);var n=o.getProgramInfoLog(u);return n&&v(n),{id:u,bind(){o.useProgram(this.id)},unbind(){o.useProgram(null)},sendFloat(r,h){let c=o.getUniformLocation(this.id,r);o.uniform1f(c,h)},sendVec2(r,h,c){let a=o.getUniformLocation(this.id,r);o.uniform2f(a,h,c)},sendVec3(r,h,c,a){let m=o.getUniformLocation(this.id,r);o.uniform3f(m,h,c,a)},sendVec4(r,h,c,a,m){let g=o.getUniformLocation(this.id,r);o.uniform4f(g,h,c,a,m)},sendMat4(r,h){let c=o.getUniformLocation(this.id,r);o.uniformMatrix4fv(c,!1,new Float32Array(h))}}}function Ie(e,t,s,n){let i=e.width/t,u=e.height/s,r=i*u,h=1/i,c=1/u,a={};n=n.split("");for(let[m,g]of n.entries())a[g]=f(m%i*h,Math.floor(m/i)*c);return{tex:e,map:a,qw:h,qh:c}}function De(e,t,s=l.defTex){l.curTex!==s&&(Ct(),l.curTex=s),e=e.map(n=>{let i=be(l.transform.multVec2(n.pos));return[i.x,i.y,n.pos.z,n.uv.x,n.uv.y,n.color.r,n.color.g,n.color.b,n.color.a]}).flat(),l.mesh.push(e,t)}function st(e={}){var g,k;let t=e.width||0,s=e.height||0,n=e.pos||f(0,0),u=rt(e.origin||ft).dot(f(t,s).scale(-.5)),r=f((g=e.scale)!=null?g:1),h=e.rot||0,c=e.quad||Y(0,0,1,1),a=1-((k=e.z)!=null?k:0),m=e.color||I();zt(),Ut(n),Ee(r),Se(h),Ut(u),De([{pos:at(-t/2,s/2,a),uv:f(c.x,c.y+c.h),color:m},{pos:at(-t/2,-s/2,a),uv:f(c.x,c.y),color:m},{pos:at(t/2,-s/2,a),uv:f(c.x+c.w,c.y),color:m},{pos:at(t/2,s/2,a),uv:f(c.x+c.w,c.y+c.h),color:m}],[0,1,3,1,2,3],e.tex),Bt()}function Nt(e,t={}){let s=typeof e=="string"?b.sprites[e]:e;if(!s){console.warn(`sprite not found: ${e}`);return}let n=mt({},s.frames[t.frame||0]);t.quad&&(n.x+=t.quad.x*n.w,n.y+=t.quad.y*n.h,n.w*=t.quad.w,n.h*=t.quad.h);let i=s.tex.width*n.w,u=s.tex.height*n.h;st({tex:s.tex,quad:n,width:i,height:u,pos:t.pos,scale:t.scale,rot:t.rot,color:t.color,origin:t.origin,z:t.z})}function nt(e,t,s,n={}){let i=rt(n.origin||ft).dot(t,s).scale(.5),u=e.add(f(-t/2,-s/2)).sub(i),r=e.add(f(-t/2,s/2)).sub(i),h=e.add(f(t/2,s/2)).sub(i),c=e.add(f(t/2,-s/2)).sub(i);H(u,r,n),H(r,h,n),H(h,c,n),H(c,u,n)}function V(e,t,s,n={}){st({pos:e,width:t,height:s,scale:n.scale,rot:n.rot,color:n.color,origin:n.origin,z:n.z})}function H(e,t,s={}){let n=s.width||1,i=e.dist(t),u=Math.PI/2-e.angle(t);st({pos:e.add(t).scale(.5),width:n,height:i,rot:u,origin:"center",color:s.color,z:s.z})}function Fe(e,t={}){it(j(e,t))}function it(e){for(let t of e.chars)st({tex:t.tex,width:t.tex.width*t.quad.w,height:t.tex.height*t.quad.h,pos:t.pos,scale:t.scale,color:t.color,quad:t.quad,origin:"center",z:t.z})}function Pe(e={}){}function Me(e={}){}function B(){return o.drawingBufferWidth/d.scale}function N(){return o.drawingBufferHeight/d.scale}function rt(e){if(ct(e))return e;switch(e){case"topleft":return f(-1,-1);case"top":return f(0,-1);case"topright":return f(1,-1);case"left":return f(-1,0);case"center":return f(0,0);case"right":return f(1,0);case"botleft":return f(-1,1);case"bot":return f(0,1);case"botright":return f(1,1)}}function j(e,t={}){let s=t.font||T,n=b.fonts[s];if(!n)return v(`font not found: '${s}'`),{width:0,height:0,chars:[]};let i=(e+"").split(""),u=n.qw*n.tex.width,r=n.qh*n.tex.height,h=t.size||r,c=f(h/r).dot(f(t.scale||1)),a=c.x*u,m=c.y*r,g=0,k=m,w=0,E=[[]];for(let A of i)(A===`
`||(t.width?g+a>t.width:!1))&&(k+=m,g=0,E.push([])),A!==`
`&&(E[E.length-1].push(A),g+=a),w=Math.max(w,g);t.width&&(w=t.width);let S=[],M=f(t.pos),L=rt(t.origin||ft).scale(.5),z=-L.x*a-(L.x+.5)*(w-a),F=-L.y*m-(L.y+.5)*(k-m);return E.forEach((A,X)=>{let Q=(w-A.length*a)*(L.x+.5);A.forEach((O,Us)=>{let bt=n.map[O],zs=Us*a,Bs=X*m;bt&&S.push({tex:n.tex,quad:Y(bt.x,bt.y,n.qw,n.qh),ch:O,pos:f(M.x+zs+z+Q,M.y+Bs+F),color:t.color,origin:t.origin,scale:c,z:t.z})})}),{width:w,height:k,chars:S}}let R={};function Le(){R.sounds={},R.ctx=new(window.AudioContext||window.webkitAudioContext),R.gainNode=R.ctx.createGain(),R.gainNode.gain.value=1,R.gainNode.connect(R.ctx.destination)}function qe(e){return e!==void 0&&(R.gainNode.gain.value=e),R.gainNode.gain.value}function Ce(e,t={}){let s=R.sounds[e];if(!s){v(`sound not found: "${e}"`);return}let n=R.ctx.createBufferSource();n.buffer=s,n.loop=!!t.loop;let i=R.ctx.createGain();n.connect(i),i.connect(R.gainNode),n.start();let u=!1,r=!1,h=1,c={stop(){n.stop(),r=!0},resume(){u&&(n.playbackRate.value=h,u=!1)},pause(){n.playbackRate.value=0,u=!0},paused(){return u},stopped(){return r},speed(a){return a!==void 0&&(h=Math.clamp(a,0,2),u||(n.playbackRate.value=h)),h},detune(a){return n.detune?(a!==void 0&&(n.detune.value=Math.clamp(a,-1200,1200)),n.detune.value):0},volume(a){return a!==void 0&&(i.gain.value=Math.clamp(a,0,3)),i.gain.value},loop(){n.loop=!0},unloop(){n.loop=!1}};return c.speed(t.speed),c.detune(t.detune),c.volume(t.volume),c}Math.radians=function(e){return e*Math.PI/180},Math.degrees=function(e){return e*180/Math.PI},Math.clamp=function(e,t,s){return Math.min(Math.max(e,t),s)};function ot(e,t,s){return e+(t-e)*s*q()}function yt(e,t,s,n,i){return n+(e-t)/(s-t)*(i-n)}function at(e,t,s){return{x:e,y:t,z:s}}function f(e,t){return ct(e)&&t===void 0?f(e.x,e.y):{x:e!=null?e:0,y:t!=null?t:e!=null?e:0,clone(){return f(this.x,this.y)},add(...s){return s=f(...s),f(this.x+s.x,this.y+s.y)},sub(...s){return s=f(...s),f(this.x-s.x,this.y-s.y)},scale(s){return f(this.x*s,this.y*s)},dist(...s){return s=f(...s),Math.sqrt((this.x-s.x)*(this.x-s.x)+(this.y-s.y)*(this.y-s.y))},len(){return this.dist(f(0,0))},unit(){return this.scale(1/this.len())},normal(){return f(this.y,-this.x)},dot(...s){return s=f(...s),f(this.x*s.x,this.y*s.y)},angle(...s){return s=f(...s),Math.atan2(this.y-s.y,this.x-s.x)},lerp(s,n){return f(ot(this.x,s.x,n),ot(this.y,s.y,n))},eq(s){return this.x===s.x&&this.y===s.y},str(){return`(${this.x}, ${this.y})`}}}function Ue(e){return f(Math.cos(e),Math.sin(e))}function ct(e){return e!==void 0&&e.x!==void 0&&e.y!==void 0}function Yt(e){return e!==void 0&&e.r!==void 0&&e.g!==void 0&&e.b!==void 0&&e.a!==void 0}function ze(e,t,s){return I(e,t,s,1)}function I(e,t,s,n){return arguments.length===0?I(1,1,1,1):{r:e,g:t,b:s,a:n===void 0?1:n,clone(){return I(this.r,this.g,this.b,this.a)},lighten(i){return I(this.r+i,this.g+i,this.b+i,this.a)},darken(i){return this.lighten(-i)},eq(i){return this.r===i.r&&this.g===i.g&&this.b===i.g&&this.a===i.a}}}function Y(e,t,s,n){return{x:e,y:t,w:s,h:n,clone(){return Y(this.x,this.y,this.w,this.h)},eq(i){return this.x===i.x&&this.y===i.y&&this.w===i.w&&this.h===i.h}}}function $t(e,t){return e.p2.x>=t.p1.x&&e.p1.x<=t.p2.x&&e.p2.y>=t.p1.y&&e.p1.y<=t.p2.y}function Be(e,t){return e.p2.x>t.p1.x&&e.p1.x<t.p2.x&&e.p2.y>t.p1.y&&e.p1.y<t.p2.y}function ut(e,t){let s=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/((t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y)),n=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/((t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y));return s>=0&&s<=1&&n>=0&&n<=1}function Gs(e,t){return xt(e,t.p1)||xt(e,t.p2)?!0:ut(t,W(e.p1,f(e.p2.x,e.p1.y)))||ut(t,W(f(e.p2.x,e.p1.y),e.p2))||ut(t,W(e.p2,f(e.p1.x,e.p2.y)))||ut(t,W(f(e.p1.x,e.p2.y),e.p1))}function xt(e,t){return t.x>=e.p1.x&&t.x<=e.p2.x&&t.y>=e.p1.y&&t.y<e.p2.y}function W(e,t){return{p1:e.clone(),p2:t.clone(),clone(){return W(this.p1,this.p2)}}}function P(e){return{m:e?[...e]:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],clone(){return P(this.m)},mult(t){let s=[];for(let n=0;n<4;n++)for(let i=0;i<4;i++)s[n*4+i]=this.m[0*4+i]*t.m[n*4+0]+this.m[1*4+i]*t.m[n*4+1]+this.m[2*4+i]*t.m[n*4+2]+this.m[3*4+i]*t.m[n*4+3];return P(s)},multVec4(t){return{x:t.x*this.m[0]+t.y*this.m[4]+t.z*this.m[8]+t.w*this.m[12],y:t.x*this.m[1]+t.y*this.m[5]+t.z*this.m[9]+t.w*this.m[13],z:t.x*this.m[2]+t.y*this.m[6]+t.z*this.m[10]+t.w*this.m[14],w:t.x*this.m[3]+t.y*this.m[7]+t.z*this.m[11]+t.w*this.m[15]}},multVec3(t){let s=this.multVec4({x:t.x,y:t.y,z:t.z,w:1});return{x:s.x,y:s.y,z:s.z}},scale(t){return this.mult(P([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1]))},translate(t){return this.mult(P([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1]))},rotateX(t){return this.mult(P([1,0,0,0,0,Math.cos(t),-Math.sin(t),0,0,Math.sin(t),Math.cos(t),0,0,0,0,1]))},rotateY(t){return this.mult(P([Math.cos(t),0,-Math.sin(t),0,0,1,0,0,Math.sin(t),0,Math.cos(t),0,0,0,0,1]))},rotateZ(t){return this.mult(P([Math.cos(t),-Math.sin(t),0,0,Math.sin(t),Math.cos(t),0,0,0,0,1,0,0,0,0,1]))},multVec2(t){return f(t.x*this.m[0]+t.y*this.m[4]+0*this.m[8]+1*this.m[12],t.x*this.m[1]+t.y*this.m[5]+0*this.m[9]+1*this.m[13])},invert(){let t=[],s=this.m[10]*this.m[15]-this.m[14]*this.m[11],n=this.m[9]*this.m[15]-this.m[13]*this.m[11],i=this.m[9]*this.m[14]-this.m[13]*this.m[10],u=this.m[8]*this.m[15]-this.m[12]*this.m[11],r=this.m[8]*this.m[14]-this.m[12]*this.m[10],h=this.m[8]*this.m[13]-this.m[12]*this.m[9],c=this.m[6]*this.m[15]-this.m[14]*this.m[7],a=this.m[5]*this.m[15]-this.m[13]*this.m[7],m=this.m[5]*this.m[14]-this.m[13]*this.m[6],g=this.m[4]*this.m[15]-this.m[12]*this.m[7],k=this.m[4]*this.m[14]-this.m[12]*this.m[6],w=this.m[5]*this.m[15]-this.m[13]*this.m[7],E=this.m[4]*this.m[13]-this.m[12]*this.m[5],S=this.m[6]*this.m[11]-this.m[10]*this.m[7],M=this.m[5]*this.m[11]-this.m[9]*this.m[7],L=this.m[5]*this.m[10]-this.m[9]*this.m[6],z=this.m[4]*this.m[11]-this.m[8]*this.m[7],F=this.m[4]*this.m[10]-this.m[8]*this.m[6],A=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*s-this.m[6]*n+this.m[7]*i,t[4]=-(this.m[4]*s-this.m[6]*u+this.m[7]*r),t[8]=this.m[4]*n-this.m[5]*u+this.m[7]*h,t[12]=-(this.m[4]*i-this.m[5]*r+this.m[6]*h),t[1]=-(this.m[1]*s-this.m[2]*n+this.m[3]*i),t[5]=this.m[0]*s-this.m[2]*u+this.m[3]*r,t[9]=-(this.m[0]*n-this.m[1]*u+this.m[3]*h),t[13]=this.m[0]*i-this.m[1]*r+this.m[2]*h,t[2]=this.m[1]*c-this.m[2]*a+this.m[3]*m,t[6]=-(this.m[0]*c-this.m[2]*g+this.m[3]*k),t[10]=this.m[0]*w-this.m[1]*g+this.m[3]*E,t[14]=-(this.m[0]*m-this.m[1]*k+this.m[2]*E),t[3]=-(this.m[1]*S-this.m[2]*M+this.m[3]*L),t[7]=this.m[0]*S-this.m[2]*z+this.m[3]*F,t[11]=-(this.m[0]*M-this.m[1]*z+this.m[3]*A),t[15]=this.m[0]*L-this.m[1]*F+this.m[2]*A;let X=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let Q=0;Q<4;Q++)for(let O=0;O<4;O++)t[Q*4+O]*=1/X;return P(t)}}}function Ne(e,t,s=1,n=0){return e+(Math.sin(qt()*s+n)+1)/2*(t-e)}let Ye=1103515245,$e=12345,Xt=2147483648,Ot=Gt(Date.now());function Gt(e){return{seed:e,gen(t,s){if(ct(t)&&ct(s))return f(this.gen(t.x,s.x),this.gen(t.y,s.y));if(Yt(t)&&Yt(s))return I(this.gen(t.r,s.r),this.gen(t.g,s.g),this.gen(t.b,s.b),this.gen(t.a,s.a));if(t!==void 0)return s===void 0?this.gen()*t:this.gen()*(s-t)+t;if(t===void 0&&s===void 0)return this.seed=(Ye*this.seed+$e)%Xt,this.seed/Xt;v("invalid param to rand()")}}}function Xe(e){Ot.seed=e}function ht(e,t){return Ot.gen(e,t)}function Oe(e){return ht(0,1)<=e}function Ge(e){return e[Math.floor(ht(e.length))]}function Ve(e){if(typeof e!="object"||e===null)return e;let t=Array.isArray(e)?[]:{};for(let s in e)t[s]=Ve(e[s]);return t}let He=980,ft="topleft",x={loaded:!1,paused:!1,scenes:{},curScene:null,nextScene:null,log:[]};function Vt(e,t){x.scenes[e]={init:t,initialized:!1,events:{add:[],update:[],draw:[],destroy:[],keyDown:[],keyPress:[],keyPressRep:[],keyRelease:[],mouseClick:[],mouseRelease:[],mouseDown:[],charInput:[]},action:[],render:[],objs:new Map,lastID:0,timers:{},lastTimerID:0,cam:{pos:f(B()/2,N()/2),scale:f(1,1),angle:0,shake:0,ignore:[],mpos:f(0)},camMousePos:f(0),layers:{},gravity:He,data:{}}}function p(){return x.scenes[x.curScene]}function je(){return p().data}function We(){let e=D;C("`",()=>{e.showLog=!e.showLog,U(`show log: ${e.showLog?"on":"off"}`)}),C("f1",()=>{e.showArea=!e.showArea,U(`show area: ${e.showArea?"on":"off"}`)}),C("f2",()=>{e.hoverInfo=!e.hoverInfo,U(`hover info: ${e.hoverInfo?"on":"off"}`)}),C("f8",()=>{e.paused=!e.paused,U(`${e.paused?"paused":"unpaused"}`)}),C("f7",()=>{e.timeScale=Math.clamp(e.timeScale-.2,0,2),U(`time scale: ${e.timeScale.toFixed(1)}`)}),C("f9",()=>{e.timeScale=Math.clamp(e.timeScale+.2,0,2),U(`time scale: ${e.timeScale.toFixed(1)}`)}),C("f10",()=>{Qt(),U("stepped frame")})}function Ze(e,...t){x.nextScene={name:e,args:[...t]}}function Ht(e,...t){Ke(e),x.curScene=e;let s=x.scenes[e];if(!s){v(`scene not found: '${e}'`);return}if(!s.initialized){try{s.init(...t)}catch(n){v(n.stack)}y.debug&&We(),s.initialized=!0}}function Ke(e){if(!x.scenes[e]){v(`scene not found: '${e}'`);return}Vt(e,x.scenes[e].init)}function Je(e,t){let s=p();if(!s)return;let n=.5/e.length;e.forEach((i,u)=>{s.layers[i]=.5+n*u}),t&&(s.defLayer=t)}function Qe(...e){let t=p().cam;return e.length>0&&(t.pos=f(...e)),t.pos.clone()}function ts(...e){let t=p().cam;return e.length>0&&(t.scale=f(...e)),t.scale.clone()}function es(e){let t=p().cam;return e!==void 0&&(t.angle=e),t.angle}function ss(e){let t=p().cam;t.shake=e}function ns(e){let t=p().cam;t.ignore=e}function jt(e){let t={hidden:!1,paused:!1,_tags:[],_events:{add:[],update:[],draw:[],destroy:[],debugInfo:[]},use(n){if(n===void 0)return;let i=typeof n;if(i==="string"){this._tags.push(n);return}if(i!=="object"){v(`invalid comp type: ${i}`);return}if(Array.isArray(n)){for(let u of n)this.use(u);return}for(let u in n){if(typeof n[u]=="function"){this._events[u]?this._events[u].push(n[u].bind(this)):this[u]=n[u].bind(this);continue}this[u]=n[u]}},exists(){return this._sceneID!==void 0},is(n){if(n==="*")return!0;if(Array.isArray(n)){for(let i of n)if(!this._tags.includes(i))return!1;return!0}return this._tags.includes(n)},on(n,i){this._events[n]||(this._events[n]=[]),this._events[n].push(i)},action(n){this.on("update",n)},trigger(n,...i){if(this._events[n])for(let h of this._events[n])h(...i);let r=p().events[n];if(r)for(let h of r)this.is(h.tag)&&h.cb(this)},addTag(n){this.is(n)||this._tags.push(n)},removeTag(n){let i=this._tags.indexOf(n);i>-1&&this._tags.splice(i,1)}};t.use(e);let s=p();s.objs.set(s.lastID,t),t._sceneID=s.lastID,s.lastID++,t.trigger("add");for(let n of s.events.add)t.is(n.tag)&&n.cb(t);return t}function is(e){if(!e.exists())return;let t=p();return t.objs.delete(e._sceneID),t.objs.set(t.lastID,e),e._sceneID=t.lastID,t.lastID++,e}function wt(e,t,s){let n=p();n.events[e]||(n.events[e]=[]),n.events[e].push({tag:t,cb:s})}function dt(e,t){typeof e=="function"&&t===void 0?p().action.push(e):wt("update",e,t)}function rs(e,t){typeof e=="function"&&t===void 0?p().render.push(e):wt("update",e,t)}function os(e,t,s){dt(e,n=>{n._checkCollisions(t,i=>{s(n,i)})})}function as(e,t,s){dt(e,n=>{n._checkOverlaps(t,i=>{s(n,i)})})}function cs(e,t){dt(e,s=>{s.isClicked()&&t(s)})}function vt(e,t){if(t){let s=p();s.timers[s.lastTimerID]={time:e,cb:t},s.lastTimerID++}else return new Promise(s=>vt(e,s))}function us(e,t){let s=()=>{t(),vt(e,s)};s()}function Z(e,t,s){if(Array.isArray(t))for(let n of t)Z(e,n,s);else p().events[e].push({key:t,cb:s})}function hs(e,t){Z("keyDown",e,t)}function C(e,t){Z("keyPress",e,t)}function fs(e,t){Z("keyPressRep",e,t)}function ds(e,t){Z("keyRelease",e,t)}function ls(e){p().events.charInput.push({cb:e})}function ms(e){p().events.mouseDown.push({cb:e})}function ps(e){p().events.mouseClick.push({cb:e})}function gs(e){p().events.mouseRelease.push({cb:e})}function K(e){let s=[...p().objs.values()];return e?s.filter(n=>n.is(e)):s}function $(e,t){typeof e=="function"&&t===void 0?K().forEach(e):K(e).forEach(t)}function ys(e,t){typeof e=="function"&&t===void 0?K().reverse().forEach(e):K(e).reverse().forEach(t)}function _t(e){if(!e.exists())return;let t=p();!t||(e.trigger("destroy"),t.objs.delete(e._sceneID),delete e._sceneID)}function xs(e){$(e,t=>{_t(t)})}function Wt(e){let t=p();return e!==void 0&&(t.gravity=e),t.gravity}let Vs=6;function Zt(e){let t=p();if(!t){v(`scene not found: '${x.curScene}'`);return}let s=e||!D.paused;if(s)for(let h in t.timers){let c=t.timers[h];c.time-=q(),c.time<=0&&(c.cb(),delete t.timers[h])}if(ys(h=>{!h.paused&&s&&h.trigger("update")}),s)for(let h of t.action)h();let n=f(B(),N()),i=t.cam,u=Ue(ht(0,Math.PI*2)).scale(i.shake);i.shake=ot(i.shake,0,5);let r=P().translate(n.scale(.5)).scale(i.scale).rotateZ(i.angle).translate(n.scale(-.5)).translate(i.pos.scale(-1).add(n.scale(.5)).add(u));t.camMousePos=r.invert().multVec2(G()),$(h=>{h.hidden||(zt(),i.ignore.includes(h.layer)||Ae(r),h.trigger("draw"),Bt())});for(let h of t.render)h()}function ws(){x.log.length>D.logMax&&(x.log=x.log.slice(0,D.logMax));let e=f(0,N());D.showLog,x.log.filter(s=>D.showLog?!0:s.type==="error").forEach((s,n)=>{let i=yt(n,0,D.logMax,1,.2),u=yt(n,0,D.logMax,.7,.2),r=(()=>{switch(s.type){case"log":return I(1,1,1,i);case"error":return I(1,0,.5,i)}})(),h=j(s.msg,{pos:e,origin:"botleft",color:r,z:1});V(e,h.width,h.height,{origin:"botleft",color:I(0,0,0,u),z:1}),it(h),e.y-=h.height})}function vs(e,...t){let s,n=i=>{let u=!1,r=i/1e3,h=r-d.realTime;if(d.realTime=r,d.skipTime||(d.dt=h*D.timeScale,d.time+=d.dt),d.skipTime=!1,_e(),x.loaded){let c=p();if(!c){v(`scene not found: '${x.curScene}'`);return}for(let a of c.events.charInput)ge().forEach(a.cb);for(let a of c.events.keyDown)Mt(a.key)&&a.cb(a.key);for(let a of c.events.keyPress)Ft(a.key)&&a.cb(a.key);for(let a of c.events.keyPressRep)Pt(a.key)&&a.cb(a.key);for(let a of c.events.keyRelease)Lt(a.key)&&a.cb(a.key);for(let a of c.events.mouseDown)It()&&a.cb();for(let a of c.events.mouseClick)pt()&&a.cb();for(let a of c.events.mouseRelease)Dt()&&a.cb();try{Zt()}catch(a){v(a.stack),u=!0}ws();for(let a in d.keyStates)d.keyStates[a]=Tt(d.keyStates[a]);d.mouseState=Tt(d.mouseState),d.charInputted=[],x.nextScene&&(Ht.apply(null,[x.nextScene.name,...x.nextScene.args]),x.nextScene=null)}else{let c=he();if(c===1)x.loaded=!0,Ht(e,...t);else{let a=B()/2,m=12,g=f(B()/2,N()/2).sub(f(a/2,m/2));nt(g,a,m,{width:2}),V(g,a*c,m)}}Re(),u||requestAnimationFrame(n)};requestAnimationFrame(n)}function Kt(...e){return{pos:f(...e),move(...t){let s=f(...t),n=s.x*q(),i=s.y*q();this.pos.x+=n,this.pos.y+=i},debugInfo(){return{pos:`(${~~this.pos.x}, ${~~this.pos.y})`}}}}function _s(...e){return{scale:f(...e),flipX(t){this.scale.x=Math.sign(t)*Math.abs(this.scale.x)},flipY(t){this.scale.y=Math.sign(t)*Math.abs(this.scale.y)}}}function bs(e){return{angle:e}}function Rs(...e){return{color:I(...e)}}function As(e){return{origin:e}}function Es(e){return{layer:e,debugInfo(){let t=p();return{layer:this.layer||t.defLayer}}}}function Jt(e,t){let s={},n={};return{area:{p1:e,p2:t},areaWidth(){let{p1:i,p2:u}=this._worldArea();return u.x-i.x},areaHeight(){let{p1:i,p2:u}=this._worldArea();return u.y-i.y},draw(){let i=D.showArea,u=D.hoverInfo;if(!i)return;let r=i.width||2,h=i.color||I(0,1,1,1),c=this.isHovered();u&&c&&(r+=2);let a=this._worldArea(),m=f((a.p1.x+a.p2.x)/2,(a.p1.y+a.p2.y)/2),g=a.p2.x-a.p1.x,k=a.p2.y-a.p1.y;nt(a.p1,a.p2.x-a.p1.x,a.p2.y-a.p1.y,{width:r/d.scale,color:h,z:.9});let w=G(this.layer||p().defLayer);if(u&&c){let E=f(6,6).scale(1/d.scale),S=0,M=0,L=[],z=F=>{let A=j(F,{size:12/d.scale,pos:w.add(f(E.x,E.y+M)),z:1});L.push(A),S=A.width>S?A.width:S,M+=A.height};for(let F of this._tags)z(`"${F}"`);for(let F of this._events.debugInfo){let A=F();for(let X in A)z(`${X}: ${A[X]}`)}S+=E.x*2,M+=E.y*2,V(w,S,M,{color:I(0,0,0,1),z:1}),nt(w,S,M,{width:(r-2)/d.scale,color:I(0,1,1,1),z:1});for(let F of L)it(F)}},clicks(i){this.action(()=>{this.isClicked()&&i()})},isClicked(){return pt()&&this.isHovered()},hovers(i){this.action(()=>{this.isHovered()&&i()})},hasPt(i){let u=this._worldArea();return xt({p1:u.p1,p2:u.p2},i)},isHovered(){return this.hasPt(G(this.layer||p().defLayer))},resolve(){let i=[];return $(u=>{if(u===this||!u.solid||!u.area||this.layer!==u.layer)return;let r=this._worldArea(),h=u._worldArea();if(!$t(r,h))return;let c=r.p2.x-h.p1.x,a=h.p2.x-r.p1.x,m=r.p2.y-h.p1.y,g=h.p2.y-r.p1.y,k=Math.min(c,a,m,g),w;switch(k){case c:this.pos.x-=c,w="right";break;case a:this.pos.x+=a,w="left";break;case m:this.pos.y-=m,w="bottom";break;case g:this.pos.y+=g,w="top";break}i.push({obj:u,side:w})}),i},_checkCollisions(i,u){$(i,r=>{this!==r&&(s[r._sceneID]||this.isCollided(r)&&(u(r),s[r._sceneID]=r))});for(let r in s){let h=s[r];this.isCollided(h)||delete s[r]}},collides(i,u){this.action(()=>{this._checkCollisions(i,u)})},_checkOverlaps(i,u){$(i,r=>{this!==r&&(n[r._sceneID]||this.isOverlapped(r)&&(u(r),n[r._sceneID]=r))});for(let r in n){let h=n[r];this.isOverlapped(h)||delete n[r]}},overlaps(i,u){this.action(()=>{this._checkOverlaps(i,u)})},_worldArea(){let i=this.area,u=this.pos||f(0),r=this.scale||f(1),h=u.add(i.p1.dot(r)),c=u.add(i.p2.dot(r));return{p1:f(Math.min(h.x,c.x),Math.min(h.y,c.y)),p2:f(Math.max(h.x,c.x),Math.max(h.y,c.y))}},isCollided(i){if(!i.area||this.layer!==i.layer)return!1;let u=this._worldArea(),r=i._worldArea();return $t(u,r)},isOverlapped(i){if(!i.area||this.layer!==i.layer)return!1;let u=this._worldArea(),r=i._worldArea();return Be(u,r)}}}function lt(e,t,s){let n=f(e,t),i=rt(s||ft).dot(n).scale(-.5);return Jt(i.sub(n.scale(.5)),i.add(n.scale(.5)))}function Ss(e,t={}){let s=b.sprites[e];if(!s){v(`sprite not found: "${e}"`);return}let n=mt({},s.frames[0]);t.quad&&(n.x+=t.quad.x*n.w,n.y+=t.quad.y*n.h,n.w*=t.quad.w,n.h*=t.quad.h);let i=s.tex.width*n.w,u=s.tex.height*n.h,r=null,h={};return{width:i,height:u,animSpeed:t.animSpeed||.1,frame:t.frame||0,quad:t.quad||Y(0,0,1,1),add(){!this.area&&!t.noArea&&this.use(lt(this.width,this.height,this.origin))},draw(){let c=p(),a=s.frames[this.frame];Nt(s,{pos:this.pos,scale:this.scale,rot:this.angle,color:this.color,frame:this.frame,origin:this.origin,quad:this.quad,z:c.layers[this.layer||c.defLayer]})},update(){if(!r)return;let c=s.anims[r.name];r.timer+=q(),r.timer>=this.animSpeed&&(this.frame++,this.frame>c[1]&&(r.loop?this.frame=c[0]:(this.frame--,this.stop())),r.timer-=this.animSpeed)},play(c,a=!0){var g;let m=s.anims[c];if(!m){v(`anim not found: ${c}`);return}r&&this.stop(),r={name:c,loop:a,timer:0},this.frame=m[0],((g=h[c])==null?void 0:g.play)&&h[c].play()},stop(){var a;if(!r)return;let c=(a=h[r.name])==null?void 0:a.end;r=null,c&&c()},changeSprite(c){s=b.sprites[c];let a=mt({},s.frames[0]);t.quad&&(a.x+=t.quad.x*a.w,a.y+=t.quad.y*a.h,a.w*=t.quad.w,a.h*=t.quad.h),this.width=s.tex.width*a.w,this.height=s.tex.height*a.h,this.area&&!t.noArea&&this.use(lt(this.width,this.height,this.origin)),r=null,this.frame=0},numFrames(){return s.frames.length},curAnim(){return r==null?void 0:r.name},onAnimPlay(c,a){h[c]||(h[c]={}),h[c].play=a},onAnimEnd(c,a){h[c]||(h[c]={}),h[c].end=a},debugInfo(){let c={};return r&&(c.curAnim=`"${r.name}"`),c}}}function ks(e,t,s={}){return{text:e,textSize:t,font:s.font,add(){var n,i;if(!this.area&&!s.noArea){let u=p(),r=j(this.text+"",{pos:this.pos,scale:this.scale,rot:this.angle,size:this.textSize,origin:this.origin,color:this.color,font:this.font,width:s.width,z:u.layers[this.layer||u.defLayer]});this.width=r.width/(((n=this.scale)==null?void 0:n.x)||1),this.height=r.height/(((i=this.scale)==null?void 0:i.y)||1),this.use(lt(this.width,this.height,this.origin))}},draw(){let n=p(),i=j(this.text+"",{pos:this.pos,scale:this.scale,rot:this.angle,size:this.textSize,origin:this.origin,color:this.color,font:this.font,width:s.width,z:n.layers[this.layer||n.defLayer]});this.width=i.tw,this.height=i.th,it(i)}}}function Ts(e,t,s={}){return{width:e,height:t,add(){!this.area&&!s.noArea&&this.use(lt(this.width,this.height,this.origin))},draw(){let n=p();V(this.pos,this.width,this.height,{scale:this.scale,rot:this.angle,color:this.color,origin:this.origin,z:n.layers[this.layer||n.defLayer]})}}}function Is(){return{solid:!0}}let Ds=960,Fs=480;function Ps(e={}){let t=0,s=null,n=e.maxVel||Ds;return{jumpForce:e.jumpForce!==void 0?e.jumpForce:Fs,update(){this.move(0,t);let i=this.resolve(),u=!1;if(s&&(!s.exists()||!this.isCollided(s))&&(s=null,u=!0),!s){t=Math.min(t+Wt()*q(),n);for(let r of i)r.side==="bottom"&&t>0?(s=r.obj,t=0,u||this.trigger("grounded",s)):r.side==="top"&&t<0&&(t=0,this.trigger("headbump",r.obj))}},curPlatform(){return s},grounded(){return s!==null},jump(i){s=null,t=-i||-this.jumpForce}}}let D={paused:!1,timeScale:1,showArea:!1,hoverInfo:!1,showLog:!1,logMax:8};function Ms(){return D}function Ls(){return 1/q()}function qs(){return p().objs.size}function Qt(){Zt(!0)}function v(e){console.error(e),x.log.unshift({type:"error",msg:e,timer:0})}function U(e){console.log(e),x.log.unshift({type:"log",msg:e,timer:0})}function Cs(e,t={}){let s=[],n=f(t.pos),i=0,u={getPos(...r){return r=f(...r),f(n.x+r.x*t.width,n.y+r.y*t.height)},spawn(r,h){let c=(()=>{if(Array.isArray(r))return r;if(t[r]){if(typeof t[r]=="function")return t[r]();if(Array.isArray(t[r]))return[...t[r]]}else if(t.any)return t.any(r)})();if(c){c.push(Kt(n.x+h.x*t.width,n.y+h.y*t.height));let a=jt(c);s.push(a),a.use({gridPos:h.clone(),setGridPos(m){this.gridPos=m.clone(),this.pos=f(n.x+this.gridPos.x*t.width,n.y+this.gridPos.y*t.height)},moveLeft(){this.setGridPos(this.gridPos.add(f(-1,0)))},moveRight(){this.setGridPos(this.gridPos.add(f(1,0)))},moveUp(){this.setGridPos(this.gridPos.add(f(0,-1)))},moveDown(){this.setGridPos(this.gridPos.add(f(0,1)))}})}},width(){return i*t.width},height(){return e.length*t.height},destroy(){for(let r of s)_t(r)}};return e.forEach((r,h)=>{typeof r=="string"&&(r=r.split("")),i=Math.max(r.length,i),r.forEach((c,a)=>{u.spawn(c,f(a,h))})}),u}let J={start:vs,loadRoot:fe,loadSprite:de,loadSound:le,loadFont:St,newLoader:tt,width:B,height:N,dt:q,time:qt,screenshot:ye,scene:Vt,go:Ze,sceneData:je,layers:Je,camPos:Qe,camScale:ts,camRot:es,camShake:ss,camIgnore:ns,gravity:Wt,add:jt,readd:is,destroy:_t,destroyAll:xs,get:K,every:$,pos:Kt,scale:_s,rotate:bs,color:Rs,origin:As,layer:Es,area:Jt,sprite:Ss,text:ks,rect:Ts,solid:Is,body:Ps,on:wt,action:dt,render:rs,collides:os,overlaps:as,clicks:cs,keyDown:hs,keyPress:C,keyPressRep:fs,keyRelease:ds,charInput:ls,mouseDown:ms,mouseClick:ps,mouseRelease:gs,mousePos:G,keyIsDown:Mt,keyIsPressed:Ft,keyIsPressedRep:Pt,keyIsReleased:Lt,mouseIsDown:It,mouseIsClicked:pt,mouseIsReleased:Dt,loop:us,wait:vt,play:Ce,volume:qe,makeRng:Gt,rand:ht,randSeed:Xe,vec2:f,rgb:ze,rgba:I,quad:Y,choose:Ge,chance:Oe,lerp:ot,map:yt,wave:Ne,drawSprite:Nt,drawText:Fe,drawRect:V,drawRectStroke:nt,drawLine:H,drawPoly:Pe,drawCircle:Me,dbg:Ms,objCount:qs,fps:Ls,stepFrame:Qt,log:U,error:v,addLevel:Cs};if(y.plugins)for(let e of y.plugins){let t=e(J);for(let s in t)J[s]=t[s]}if(y.global)for(let e in J)window[e]=J[e];return pe(),J};
//# sourceMappingURL=kaboom.min.cjs.map
